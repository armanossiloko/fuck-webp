<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fuck WEBP - Image Converter</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #1e1e1e;
            color: #e0e0e0;
            min-height: 100vh;
            overflow: hidden;
        }

        .container {
            width: 100vw;
            height: 100vh;
            display: flex;
            flex-direction: column;
            padding: 5px;
        }

        .format-selector {
            z-index: 9999;
            margin-bottom: 25px;
            text-align: center;
        }

        .format-selector label {
            display: block;
            margin-bottom: 10px;
            font-size: 1rem;
            font-weight: 500;
            color: #b0b0b0;
        }

        .format-selector select {
            padding: 10px 15px;
            font-size: 1rem;
            border: 2px solid #333;
            border-radius: 5px;
            background: #2d2d2d;
            color: #e0e0e0;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .format-selector select:focus {
            outline: none;
            border-color: #4a69ff;
            box-shadow: 0 0 0 2px rgba(74, 105, 255, 0.2);
        }

        .drop-zone {
            width: 100%;
            flex: 1;
            border: 2px dashed #4a69ff;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: #252525;
            transition: all 0.2s ease;
            cursor: pointer;
            position: relative;
            padding: 40px 20px;
            border-radius: 8px;
        }

        .drop-zone:hover {
            background: #2a2a2a;
            border-color: #5a76ff;
        }

        .drop-zone.dragover {
            background: #2a2a2a;
            border-color: #5a76ff;
            transform: scale(1.01);
        }

        .drop-zone-title {
            font-size: 2.2rem;
            color: #ff6b8b;
            text-align: center;
            margin-bottom: 10px;
        }

        .drop-zone-subtitle {
            font-size: 1rem;
            color: #b0b0b0;
            text-align: center;
            margin-bottom: 25px;
            max-width: 600px;
        }

        .drop-zone-text {
            font-size: 1rem;
            color: #d0d0d0;
            margin-bottom: 8px;
        }

        .file-input {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            cursor: pointer;
        }

        .status-message {
            margin-top: 15px;
            padding: 12px 15px;
            border-radius: 5px;
            text-align: center;
            font-weight: 500;
            max-width: 90%;
            word-wrap: break-word;
            line-height: 1.4;
        }

        .status-success {
            background: rgba(76, 175, 80, 0.2);
            color: #4caf50;
            border: 1px solid #4caf50;
        }

        .status-error {
            background: rgba(244, 67, 54, 0.2);
            color: #f44336;
            border: 1px solid #f44336;
        }

        .status-loading {
            background: rgba(33, 150, 243, 0.2);
            color: #2196f3;
            border: 1px solid #2196f3;
        }

        @media (max-width: 768px) {
            .drop-zone-title {
                font-size: 1.8rem;
            }

            .drop-zone-subtitle {
                font-size: 0.9rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
		<div class="drop-zone" id="drop-zone">
			<div class="drop-zone-title">Fuck WEBP</div>
			<div class="drop-zone-subtitle">I hate WEBP and there's a high chance that you do too. Convert it to PNG or JPG here!</div>
			
			<div class="format-selector">
				<label for="output-format">Convert to:</label>
				<select id="output-format">
					<option value="png">PNG</option>
					<option value="jpeg">JPEG</option>
				</select>
			</div>
			
			<div class="drop-zone-text">
				<ul style="list-style-type: disc; text-align: left; display: inline-block;">
					<li>Drag & drop your WEBP files here</li>
					<li>Or click to browse files</li>
					<li>Or just paste them from clipboard</li>
				</ul>
			</div>
			<input type="file" class="file-input" id="file-input" accept="image/*" multiple>
		</div>
    </div>

    <script>
        const dropZone = document.getElementById('drop-zone');
        const fileInput = document.getElementById('file-input');
        const outputFormat = document.getElementById('output-format');

        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            dropZone.addEventListener(eventName, preventDefaults, false);
            document.body.addEventListener(eventName, preventDefaults, false);
        });

        ['dragenter', 'dragover'].forEach(eventName => {
            dropZone.addEventListener(eventName, highlight, false);
        });

        ['dragleave', 'drop'].forEach(eventName => {
            dropZone.addEventListener(eventName, unhighlight, false);
        });

        dropZone.addEventListener('drop', handleDrop, false);
        fileInput.addEventListener('change', handleFiles);
        document.addEventListener('paste', handlePaste, false);

        function preventDefaults(e) {
            e.preventDefault();
            e.stopPropagation();
        }

        function highlight(e) {
            dropZone.classList.add('dragover');
        }

        function unhighlight(e) {
            dropZone.classList.remove('dragover');
        }

        function showStatus(message, type = 'success') {
            const existingStatus = dropZone.querySelector('.status-message');
            if (existingStatus) {
                existingStatus.remove();
            }

            const statusDiv = document.createElement('div');
            statusDiv.className = `status-message status-${type}`;
            statusDiv.textContent = message;
            dropZone.appendChild(statusDiv);

            if (type === 'success') {
                setTimeout(() => {
                    if (statusDiv.parentNode) {
                        statusDiv.remove();
                    }
                }, 3000);
            }
        }

        function handleDrop(e) {
            const dt = e.dataTransfer;
            const files = dt.files;
            handleFiles({ target: { files } });
        }

        function handleFiles(e) {
            const files = [...e.target.files];
            if (files.length === 0) {
                showStatus('No files selected', 'error');
                return;
            }

            const imageFiles = files.filter(file => 
                file.type.startsWith('image/') || /\.(webp|jpg|jpeg|png|gif|bmp|tiff|svg)$/i.test(file.name)
            );

            if (imageFiles.length === 0) {
                showStatus('No valid image files found', 'error');
                return;
            }

            showStatus(`Converting ${imageFiles.length} file(s)...`, 'loading');
            convertFiles(imageFiles);
        }

        function handlePaste(e) {
            const items = e.clipboardData.items;
            if (!items) {
                return;
            }

            const imageItems = [];
            
            for (let i = 0; i < items.length; i++) {
                const item = items[i];
                if (item.type.indexOf('image') !== -1) {
                    imageItems.push(item);
                }
            }

            if (imageItems.length === 0) {
                showStatus('No images found in clipboard', 'error');
                return;
            }

            const files = [];
            imageItems.forEach((item, index) => {
                const file = item.getAsFile();
                if (file) {
                    const timestamp = new Date().getTime();
                    const extension = file.type.split('/')[1] || 'webp';
                    file.name = `pasted-image-${timestamp}-${index + 1}.${extension}`;
                    files.push(file);
                }
            });

            if (files.length > 0) {
                showStatus(`Converting ${files.length} pasted image(s)...`, 'loading');
                convertFiles(files);
            }
        }

		function convertFiles(files) {
            const format = outputFormat.value;
            let completedFiles = 0;
            let failedFiles = 0;
            const totalFiles = files.length;

            files.forEach((file, index) => {
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    const img = new Image();
                    
                    img.onload = function() {
                        try {
                            const canvas = document.createElement('canvas');
                            canvas.width = img.width;
                            canvas.height = img.height;
                            
                            const ctx = canvas.getContext('2d');
                            ctx.drawImage(img, 0, 0);

                            canvas.toBlob(function(blob) {
                                if (blob) {
                                    const reader = new FileReader();
                                    reader.onload = function(e) {
                                        const newTab = window.open();
                                        newTab.document.write(`<img src="${e.target.result}" style="max-width:100%;height:auto;">`);
                                        newTab.document.title = `converted-image.${format}`;
                                        
                                        completedFiles++;
                                        updateProgress();
                                    };
                                    reader.readAsDataURL(blob);
                                } else {
                                    failedFiles++;
                                    updateProgress();
                                }
                            }, `image/${format}`);
                        } catch (error) {
                            console.error('Error converting file:', file.name, error);
                            failedFiles++;
                            updateProgress();
                        }
                    };
                    
                    img.onerror = function() {
                        console.error('Error loading image:', file.name);
                        failedFiles++;
                        updateProgress();
                    };
                    
                    img.src = e.target.result;
                };
                
                reader.onerror = function() {
                    console.error('Error reading file:', file.name);
                    failedFiles++;
                    updateProgress();
                };
                
                reader.readAsDataURL(file);
            });

            function updateProgress() {
                const totalProcessed = completedFiles + failedFiles;
                
                if (totalProcessed === totalFiles) {
                    if (failedFiles === 0) {
                        showStatus(`Successfully converted ${completedFiles} file(s) to ${format.toUpperCase()}!`, 'success');
                    } else if (completedFiles === 0) {
                        showStatus(`Failed to convert ${failedFiles} file(s). Please check if they are valid images.`, 'error');
                    } else {
                        showStatus(`Converted ${completedFiles} file(s) to ${format.toUpperCase()}, ${failedFiles} failed.`, 'success');
                    }
                } else {
                    const progressMessage = `Converting ${totalProcessed}/${totalFiles} file(s)...`;
                    if (completedFiles > 0 || failedFiles > 0) {
                        showStatus(`${progressMessage} (${completedFiles} completed, ${failedFiles} failed)`, 'loading');
                    } else {
                        showStatus(progressMessage, 'loading');
                    }
                }
            }
        }
		
    </script>
</body>
</html>
